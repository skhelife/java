<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>æ•°æ®è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }

        .section {
            margin: 20px 0;
            padding: 15px;
            background: #16213e;
            border-radius: 8px;
        }

        .section h2 {
            color: #4ecca3;
            margin-top: 0;
        }

        pre {
            background: #0f1419;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }

        .error {
            color: #ff6b6b;
        }

        .success {
            color: #4ecca3;
        }

        button {
            background: #4ecca3;
            color: #1a1a2e;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #45b393;
        }
    </style>
</head>

<body>
    <h1>ğŸ” Mockæ•°æ®è°ƒè¯•å·¥å…·</h1>

    <div class="section">
        <h2>å¿«é€Ÿæ“ä½œ</h2>
        <button onclick="clearData()">æ¸…ç©ºLocalStorage</button>
        <button onclick="loadData()">é‡æ–°åŠ è½½æ•°æ®</button>
        <button onclick="checkData()">æ£€æŸ¥æ•°æ®å®Œæ•´æ€§</button>
    </div>

    <div class="section">
        <h2>æ•°æ®æ¦‚è§ˆ</h2>
        <div id="overview"></div>
    </div>

    <div class="section">
        <h2>ç­çº§æ•°æ®</h2>
        <div id="classes"></div>
    </div>

    <div class="section">
        <h2>æˆç»©æ•°æ® (å‰10æ¡)</h2>
        <div id="grades"></div>
    </div>

    <div class="section">
        <h2>æˆç»©classIdåˆ†å¸ƒ</h2>
        <div id="classIdDist"></div>
    </div>

    <script type="module">
        import { getMockData, saveMockData } from './src/services/mockData.ts'

        window.clearData = () => {
            localStorage.clear()
            alert('âœ… LocalStorageå·²æ¸…ç©ºï¼Œè¯·é‡æ–°åŠ è½½é¡µé¢')
            location.reload()
        }

        window.loadData = () => {
            saveMockData()
            alert('âœ… æ•°æ®å·²é‡æ–°ç”Ÿæˆ')
            checkData()
        }

        window.checkData = checkData

        function checkData() {
            const data = getMockData()

            // æ•°æ®æ¦‚è§ˆ
            const overview = document.getElementById('overview')
            overview.innerHTML = `
                <pre class="success">
å­¦ç”Ÿæ€»æ•°: ${data.students.length}
è¯¾ç¨‹æ€»æ•°: ${data.courses.length}
æ•™å¸ˆæ€»æ•°: ${data.teachers.length}
æ•™å­¦ç­æ•°: ${data.classes.length}
æˆç»©æ€»æ•°: ${data.grades.length}
ç”¨æˆ·æ€»æ•°: ${data.users.length}
è§’è‰²æ€»æ•°: ${data.roles.length}
                </pre>
            `

            // ç­çº§æ•°æ®
            const classes = document.getElementById('classes')
            classes.innerHTML = `
                <pre>${JSON.stringify(data.classes, null, 2)}</pre>
            `

            // æˆç»©æ•°æ®å‰10æ¡
            const grades = document.getElementById('grades')
            const first10Grades = data.grades.slice(0, 10)
            grades.innerHTML = `
                <pre>${JSON.stringify(first10Grades, null, 2)}</pre>
            `

            // classIdåˆ†å¸ƒ
            const classIdDist = document.getElementById('classIdDist')
            const distribution = {}
            data.grades.forEach(g => {
                const cid = g.classId
                distribution[cid] = (distribution[cid] || 0) + 1
            })

            let distHTML = '<pre class="success">'
            Object.entries(distribution).forEach(([classId, count]) => {
                const classInfo = data.classes.find(c => c.classId === classId)
                const course = data.courses.find(c => c.id === classInfo?.courseId)
                distHTML += `${classId}: ${count}äºº (${course?.courseName || 'æœªçŸ¥'})\n`
            })
            distHTML += '</pre>'

            // æ£€æŸ¥é—®é¢˜
            distHTML += '<h3>âš ï¸ æ½œåœ¨é—®é¢˜æ£€æŸ¥:</h3><pre>'

            // æ£€æŸ¥1: æ˜¯å¦æœ‰æˆç»©çš„classIdä¸åœ¨classesä¸­
            const validClassIds = new Set(data.classes.map(c => c.classId))
            const invalidGrades = data.grades.filter(g => !validClassIds.has(g.classId))
            if (invalidGrades.length > 0) {
                distHTML += `<span class="error">âŒ å‘ç° ${invalidGrades.length} æ¡æˆç»©çš„classIdæ— æ•ˆ</span>\n`
                distHTML += `æ— æ•ˆçš„classIdç¤ºä¾‹: ${invalidGrades.slice(0, 3).map(g => g.classId).join(', ')}\n`
            } else {
                distHTML += `<span class="success">âœ… æ‰€æœ‰æˆç»©çš„classIdéƒ½æœ‰æ•ˆ</span>\n`
            }

            // æ£€æŸ¥2: æ¯ä¸ªclassæ˜¯å¦éƒ½æœ‰å­¦ç”Ÿ
            data.classes.forEach(cls => {
                const studentCount = data.grades.filter(g => g.classId === cls.classId).length
                if (studentCount === 0) {
                    distHTML += `<span class="error">âŒ ç­çº§ ${cls.classId} æ²¡æœ‰å­¦ç”Ÿ</span>\n`
                } else {
                    distHTML += `<span class="success">âœ… ç­çº§ ${cls.classId} æœ‰ ${studentCount} åå­¦ç”Ÿ</span>\n`
                }
            })

            distHTML += '</pre>'
            classIdDist.innerHTML = distHTML
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        checkData()
    </script>
</body>

</html>